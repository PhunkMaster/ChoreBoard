### Thanks — excellent clarifications. I’ve reconciled your updates and propose the final behavior below, plus a few focused questions so I can start building immediately.

---

### Updated design commitments (based on your confirmations)
- Single Docker image (no compose). Django + HTMX + Tailwind; static built at image build; served via WhiteNoise. One process runs Django + APScheduler.
- Auth: Django users now; future‑ready for Keycloak/OIDC. Public kiosk: completion and claim allowed without login; admin features behind login-only URL.
- Timezone: `APP_TIMEZONE` env; default `America/Chicago`. All “midnight” logic and schedules use this.
- Scheduling & recurrence:
  - Daily, weekly, every N days (with explicit start date). When completed late, next due = completion time + N days.
  - Advanced rules via `rrule` JSON (supports 1st/3rd Friday, Mon+Wed, etc.). Easy to evolve later.
  - Weekly chores: due at midnight on target day; overdue at next midnight.
- Assignment & rotation:
  - Separate concepts: assignment‑eligible users vs points‑eligible users (independent flags).
  - Force‑assignment at per‑chore time (default 17:30). Selection: eligible pool → exclude last period’s completers → fewest force‑assignments today → random tie‑break; if none available, leave unassigned in “purple” with reason for admin.
  - Difficult chores: when auto‑assigning, avoid giving a user a second difficult chore on the same day (claims still allowed; see Q8).
- Claims: 1 claim per user/day; undo restores allowance.
- Points:
  - Equal split only; rounded to hundredths at ledger.
  - If only ineligible helpers complete a chore, distribute its points equally among all points‑eligible users (see Q2 scope).
  - No negative totals: weekly/all‑time are floored at 0 when undoing.
  - Conversion rate 100 points per $1, admin‑only; points label configurable (default Phil/Phils).
- Streaks: global; reset if any overdue in week; admin can override/increment.
- Logs: evaluation and action logs; 30‑day retention.
- UI: dark theme; green for on‑time, red for overdue, purple for assignment‑blocked; show last completion time and last completer.
- “Late chore” (as a category): per‑chore boolean `is_late_chore` meaning “intended after dinner.”
- “Tardy” status (renamed to avoid confusion): optional `target_completion_time` with modes None / Server Default / Custom. If not completed by target time (but before midnight), instance is marked `tardy` (internal flag) — separate from “overdue.” This will not conflict with the “late chore” category.
- REST API: include an endpoint to list a user’s outstanding “late chore” category items; optional filter to include `tardy`/overdue if desired.
- Dependency recurrence: `ChoreDependency` spawns child when parent completes. If parent is undone, child is rolled back/deleted (see Q7 for the edge case when child already completed).
- Kiosk via Home Assistant iframes: I’ll enable framing by your HA origin and expose CORS appropriately.

---

### Focused questions to finalize
1) Assignment‑eligible vs points‑eligible
- Confirm the two independent flags per user:
  - `can_be_assigned`: included in rotation/force‑assignment and can be the fixed assignee.
  - `eligible_for_points`: can receive points and appear on leaderboard.
  Default: all active users have `can_be_assigned=true`; only some have `eligible_for_points=true`. OK?

2) Points distribution when only ineligible helpers completed
- You confirmed “distribute to eligible users.” Should the distribution pool be:
  - 2a) All points‑eligible users globally (household‑wide), or
  - 2b) Only points‑eligible users who are also eligible for that chore (if the chore has a limited eligible list)?
  I recommend 2b so points stay within the chore’s intended pool.

3) Server default for `target_completion_time`
- What value should the server default be? Keep `17:30`?
- Chores marked `is_late_chore=true` are intended after dinner; do you still want them to use the same `target_completion_time` for `tardy` status, or ignore `tardy` entirely for late‑chores? My suggestion: ignore `tardy` for late‑chores and only consider overdue at midnight.

4) “Outstanding late chores” API semantics
- Should “outstanding” include only chores assigned to that user, or also pool items they could pick up?
  - Option A: assigned‑to user only
  - Option B: assigned + pool items for which the user is assignment‑eligible
  Which do you want?

5) Weekly reset flow
- Original brief said admin resets weekly points; we can either:
  - Option A: Automatically snapshot at Sunday midnight and also automatically reset weekly points.
  - Option B: Automatically snapshot at Sunday midnight, but only reset when admin clicks “Convert & Reset” (recommended, matches your brief).
  Choose A or B.

6) Home Assistant embedding details
- Please provide the exact HA origin(s)/domain(s) that will embed the app so I can configure `frame-ancestors`/CSP and CORS (e.g., `https://ha.example.com`). If using Nabu Casa remote URL, list that too.

7) Dependency rollback edge case
- If parent is undone and the child instance already exists:
  - If child is not completed → delete it.
  - If child is completed → should I automatically undo the child completion (reverting points) and delete the child instance as part of the parent undo? I propose “yes” for consistency. Confirm.

8) Difficult chores and claims
- If a user has already completed a difficult chore today, should they still be allowed to claim another difficult chore? My suggestion: allow, but show a warning on the kiosk; only the auto‑assigner avoids a second difficult chore.

9) Security for public POSTs in iframes (CSRF)
- Two simple options:
  - Option A: Use Django’s CSRF cookie and inject the token in HTMX/JS requests from the iframe (works if same site or CORS/credentials are allowed).
  - Option B: Provide a kiosk‑scoped HMAC token in the board page (read‑only GET) that must be echoed in subsequent POSTs (no cookies needed). I recommend Option B for kiosk simplicity. Which do you prefer?

10) Data persistence in Docker
- Use SQLite with a mounted volume for `db.sqlite3` and a volume for collected static files, or do you want to plug in Postgres now? For a single‑container setup, SQLite + volume is fine; we can migrate later.

11) “Purple” state notifications
- For now, should I just surface this as a visible banner on the admin pages and a purple card on the board (no emails/Discord), per your “0 integrations” decision? (We can add adapters later.)

12) Leaderboard visibility
- Board is public; is the leaderboard also public, or should it require login? If public, I’ll display only first names or usernames (no emails) and follow your points label.

---

### After your answers
I’ll start implementing the models, migrations, scheduler hooks, REST endpoints, dark/touch UI, and the Dockerfile. I’ll keep the schedule/rrule layer modular so we can tweak 1st/3rd‑Friday style rules easily in a follow‑up.
