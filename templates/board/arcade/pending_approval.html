{% extends "base.html" %}

{% block title %}Pending Approval - Arcade Mode{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">
    <!-- Header -->
    <div class="flex items-center space-x-4">
        <a href="/" class="text-gray-400 hover:text-white">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
        </a>
        <h1 class="text-3xl font-bold text-white">‚è≥ Awaiting Judge Approval</h1>
    </div>

    <!-- Status Card -->
    <div class="bg-gradient-to-br from-blue-900/40 to-indigo-900/40 border-2 border-blue-500 rounded-lg p-8">
        <div class="text-center space-y-6">
            <!-- Animated waiting icon -->
            <div class="relative inline-block">
                <div class="text-6xl animate-pulse">‚è±Ô∏è</div>
            </div>

            <div>
                <h2 class="text-2xl font-bold text-white mb-2">{{ arcade_session.chore.name }}</h2>
                <div class="text-5xl font-bold text-blue-400 mb-2">{{ arcade_session.format_time }}</div>
                <p class="text-gray-300">Completed {{ arcade_session.end_time|timesince }} ago</p>
            </div>

            <div class="bg-dark-surface rounded-lg p-4 border border-blue-500/30">
                <p class="text-gray-300 mb-2">
                    Your submission has been sent to <span class="text-blue-400 font-bold">{{ arcade_session.judge.get_display_name }}</span> for approval.
                </p>
                <p class="text-gray-400 text-sm">
                    You'll be notified once they review your completion.
                </p>
            </div>

            <!-- Completion Stats -->
            <div class="grid grid-cols-3 gap-4 text-sm">
                <div class="bg-dark-card rounded-lg p-3">
                    <p class="text-gray-500 mb-1">Points Value</p>
                    <p class="text-white font-bold text-lg">{{ arcade_session.chore_instance.points_value }} pts</p>
                </div>
                <div class="bg-dark-card rounded-lg p-3">
                    <p class="text-gray-500 mb-1">Attempt #</p>
                    <p class="text-white font-bold text-lg">{{ arcade_session.attempt_number }}</p>
                </div>
                <div class="bg-dark-card rounded-lg p-3">
                    <p class="text-gray-500 mb-1">Status</p>
                    <p class="text-blue-400 font-bold text-lg">Pending</p>
                </div>
            </div>

            <!-- Auto-refresh notice -->
            <div class="bg-yellow-900/20 border border-yellow-500/30 rounded-lg p-4">
                <p class="text-yellow-300 text-sm">
                    üí° This page will automatically refresh when your submission is reviewed.
                    You can safely navigate away and check back later.
                </p>
            </div>

            <!-- Action Buttons -->
            <div class="flex space-x-4 pt-4">
                <a href="/"
                   class="flex-1 bg-dark-card hover:bg-dark-hover text-gray-300 hover:text-white font-bold py-3 px-6 rounded-lg text-center transition border border-dark-border">
                    Back to Board
                </a>
                <a href="{% url 'board:arcade_leaderboard' %}"
                   class="flex-1 bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg text-center transition">
                    üéÆ View Leaderboard
                </a>
            </div>
        </div>
    </div>

    <!-- What's Next -->
    <div class="bg-dark-surface rounded-lg p-6 border border-dark-border">
        <h3 class="text-lg font-bold text-white mb-3">What happens next?</h3>
        <div class="space-y-2 text-gray-300">
            <div class="flex items-start space-x-3">
                <span class="text-green-400 text-xl">‚úì</span>
                <div>
                    <p class="font-semibold">If Approved</p>
                    <p class="text-sm text-gray-400">Points will be added to your total, and any bonus points for high scores will be awarded.</p>
                </div>
            </div>
            <div class="flex items-start space-x-3">
                <span class="text-red-400 text-xl">‚úó</span>
                <div>
                    <p class="font-semibold">If Denied</p>
                    <p class="text-sm text-gray-400">You'll have the option to retry with your previous time added as a penalty.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Auto-refresh script (checks every 10 seconds) -->
<script>
let checkCount = 0;
const maxChecks = 60; // Stop checking after 10 minutes

function checkApprovalStatus() {
    if (checkCount >= maxChecks) {
        console.log('Stopped auto-refresh after 10 minutes');
        return;
    }

    checkCount++;

    fetch('{% url "board:arcade_status" %}')
        .then(response => response.json())
        .then(data => {
            // If the session status has changed from 'stopped', reload
            if (!data.has_active_session || data.status !== 'stopped') {
                console.log('Session status changed, reloading...');
                window.location.reload();
            }
        })
        .catch(error => {
            console.error('Error checking status:', error);
        });
}

// Check every 10 seconds
const intervalId = setInterval(checkApprovalStatus, 10000);

// Cleanup on page unload
window.addEventListener('beforeunload', function() {
    clearInterval(intervalId);
});
</script>
{% endblock %}
